# Autor: Lara Maia <lara@craft.net.br>
# Versão: 0.8

# -------------- CONFIG -------------- #
#include /etc/squid/inComum.conf
http_port 3128 transparent
visible_hostname viny-server.com.br

detect_broken_pconn on
pipeline_prefetch on
negative_ttl 0

cache_mem 50 MB
maximum_object_size_in_memory 20 KB
memory_pools off

cache_dir aufs /var/cache/squid 256 16 256
coredump_dir /var/cache/squid
cache_replacement_policy heap LFUDA
maximum_object_size 500 MB
minimum_object_size 1 KB
cache_swap_low 90
cache_swap_high 95
cache_mgr lara@craft.net.br
cache_effective_user proxy

refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i \.(gif|png|jpg|jpeg|ico)$ 10080 90% 43200 override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i \.(iso|avi|wav|mp3|mp4|mpeg|swf|flv|x-flv)$ 43200 90% 432000 override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i \.(deb|rpm|exe|zip|tar|tgz|ram|rar|bin|ppt|doc|tiff)$ 10080 90% 43200 override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i \.index.(html|htm)$ 0 40% 10080
refresh_pattern -i \.(html|htm|css|js)$ 1440 40% 40320
refresh_pattern . 0 40% 40320

cache_log /var/log/squid/cache.log
access_log /var/log/squid/access.log
cache_store_log /var/log/squid/store.log
logfile_rotate 10
buffered_logs on

dns_nameservers 127.0.0.1

# Fix de desligamento
shutdown_lifetime 1 second

# -------------- REGRAS PADRÕES -------------- #

#acl all src all
acl manager proto cache_object
acl Safe_ports port 443    # https
acl Safe_ports port 80		# http
#acl Safe_ports port 21		# ftp
#acl Safe_ports port 70		# gopher
#acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# msn
#acl Safe_ports port 280		# http-mgmt
#acl Safe_ports port 488		# gss-http
#acl Safe_ports port 591		# filemaker
#acl Safe_ports port 777		# multiling http
acl purge method PURGE
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !Safe_ports
http_access allow purge
http_access allow manager


# ---------- REDIRECIONAMENTOS ---------- #
acl ebuddy url_regex -i www.ebuddy.com
deny_info http://web.ebuddy.com ebuddy

acl ebuddy_banner url_regex -i bsvc.ebuddy.com/bannerservice/banner
deny_info http://www.link-ware.com/images/pixel-transparente.gif ebuddy_banner

acl hotmail url_regex -i hotmail.com
deny_info http://login.live.com hotmail

acl hotmail_logout_redirect url_regex -i br.msn.com/?ocid=hmlogout
deny_info http://login.live.com hotmail_logout_redirect

acl hotmail_sumary url_regex -i account.live.com/summarypage.aspx
deny_info https://blu134.mail.live.com/?rru=inbox hotmail_sumary

#acl google url_regex -i google.com/index.php
#deny_info "http:///" google

http_access deny ebuddy
http_access deny ebuddy_banner
http_access deny hotmail
http_access deny hotmail_logout_redirect
http_access deny hotmail_sumary
#http_access deny google

# ---------- FIREWALL ---------- #
acl WhiteList url_regex -i "/etc/squid/firewall/WhiteList"
acl BlackList dstdomain "/etc/squid/firewall/BlackList"
acl BlackListContents url_regex -i "/etc/squid/firewall/BlackContents"

http_access allow WhiteList
http_access deny BlackList
http_access deny BlackListContents


# ----- Extra Redirects ----- #
http_access allow all
http_reply_access allow all
always_direct allow all
icp_access allow all
forwarded_for off

